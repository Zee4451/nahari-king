import{r as u,j as c,N as A,S as F}from"./index-Dp2xWl5K.js";import{T as q}from"./firebase-AunHK6W3.js";import"./vendor-qkC6yhPU.js";const H=typeof window<"u"?u.useLayoutEffect:u.useEffect;function W(e){if(e!==void 0)switch(typeof e){case"number":return e;case"string":{if(e.endsWith("px"))return parseFloat(e);break}}}function G({box:e,defaultHeight:t,defaultWidth:i,disabled:r,element:o,mode:n,style:d}){const{styleHeight:s,styleWidth:a}=u.useMemo(()=>({styleHeight:W(d?.height),styleWidth:W(d?.width)}),[d?.height,d?.width]),[l,f]=u.useState({height:t,width:i}),h=r||s!==void 0||n==="only-width"||s!==void 0&&a!==void 0;return H(()=>{if(o===null||h)return;const w=new ResizeObserver(v=>{for(const y of v){const{contentRect:m,target:b}=y;o===b&&f(z=>z.height===m.height&&z.width===m.width?z:{height:m.height,width:m.width})}});return w.observe(o,{box:e}),()=>{w?.unobserve(o)}},[e,h,o,s,a]),u.useMemo(()=>({height:s??l.height,width:a??l.width}),[l,s,a])}function U(e){const t=u.useRef(()=>{throw new Error("Cannot call during render.")});return H(()=>{t.current=e},[e]),u.useCallback(i=>t.current?.(i),[t])}function L({containerElement:e,direction:t,isRtl:i,scrollOffset:r}){return r}function N(e,t="Assertion error"){if(!e)throw console.error(t),Error(t)}function R(e,t){if(e===t)return!0;if(!!e!=!!t||(N(e!==void 0),N(t!==void 0),Object.keys(e).length!==Object.keys(t).length))return!1;for(const i in e)if(!Object.is(t[i],e[i]))return!1;return!0}function D({cachedBounds:e,itemCount:t,itemSize:i}){if(t===0)return 0;if(typeof i=="number")return t*i;{const r=e.get(e.size===0?0:e.size-1);N(r!==void 0,"Unexpected bounds cache miss");const o=(r.scrollOffset+r.size)/e.size;return t*o}}function Y({align:e,cachedBounds:t,index:i,itemCount:r,itemSize:o,containerScrollOffset:n,containerSize:d}){if(i<0||i>=r)throw RangeError(`Invalid index specified: ${i}`,{cause:`Index ${i} is not within the range of 0 - ${r-1}`});const s=D({cachedBounds:t,itemCount:r,itemSize:o}),a=t.get(i),l=Math.max(0,Math.min(s-d,a.scrollOffset)),f=Math.max(0,a.scrollOffset-d+a.size);switch(e==="smart"&&(n>=f&&n<=l?e="auto":e="center"),e){case"start":return l;case"end":return f;case"center":return a.scrollOffset<=d/2?0:a.scrollOffset+a.size/2>=s-d/2?s-d:a.scrollOffset+a.size/2-d/2;default:return n>=f&&n<=l?n:n<f?f:l}}function P({cachedBounds:e,containerScrollOffset:t,containerSize:i,itemCount:r,overscanCount:o}){const n=r-1;let d=0,s=-1,a=0,l=-1,f=0;for(;f<n;){const h=e.get(f);if(h.scrollOffset+h.size>t)break;f++}for(d=f,a=Math.max(0,d-o);f<n;){const h=e.get(f);if(h.scrollOffset+h.size>=t+i)break;f++}return s=Math.min(n,f),l=Math.min(r-1,s+o),d<0&&(d=0,s=-1,a=0,l=-1),{startIndexVisible:d,stopIndexVisible:s,startIndexOverscan:a,stopIndexOverscan:l}}function Z({itemCount:e,itemProps:t,itemSize:i}){const r=new Map;return{get(o){for(N(o<e,`Invalid index ${o}`);r.size-1<o;){const d=r.size;let s;switch(typeof i){case"function":{s=i(d,t);break}case"number":{s=i;break}}if(d===0)r.set(d,{size:s,scrollOffset:0});else{const a=r.get(d-1);N(a!==void 0,`Unexpected bounds cache miss for index ${o}`),r.set(d,{scrollOffset:a.scrollOffset+a.size,size:s})}}const n=r.get(o);return N(n!==void 0,`Unexpected bounds cache miss for index ${o}`),n},set(o,n){r.set(o,n)},get size(){return r.size}}}function _({itemCount:e,itemProps:t,itemSize:i}){return u.useMemo(()=>Z({itemCount:e,itemProps:t,itemSize:i}),[e,t,i])}function J({containerSize:e,itemSize:t}){let i;return typeof t==="string"?(N(t.endsWith("%"),`Invalid item size: "${t}"; string values must be percentages (e.g. "100%")`),N(e!==void 0,"Container size must be defined if a percentage item size is specified"),i=e*parseInt(t)/100):i=t,i}function K({containerElement:e,containerStyle:t,defaultContainerSize:i=0,direction:r,isRtl:o=!1,itemCount:n,itemProps:d,itemSize:s,onResize:a,overscanCount:l}){const{height:f=i,width:h=i}=G({defaultHeight:i,defaultWidth:void 0,element:e,mode:"only-height",style:t}),w=u.useRef({height:0,width:0}),v=f,y=J({containerSize:v,itemSize:s});u.useLayoutEffect(()=>{if(typeof a=="function"){const x=w.current;(x.height!==f||x.width!==h)&&(a({height:f,width:h},{...x}),x.height=f,x.width=h)}},[f,a,h]);const m=_({itemCount:n,itemProps:d,itemSize:y}),b=u.useCallback(x=>m.get(x),[m]),[z,O]=u.useState(()=>P({cachedBounds:m,containerScrollOffset:0,containerSize:v,itemCount:n,overscanCount:l})),{startIndexVisible:$,startIndexOverscan:M,stopIndexVisible:V,stopIndexOverscan:k}={startIndexVisible:Math.min(n-1,z.startIndexVisible),startIndexOverscan:Math.min(n-1,z.startIndexOverscan),stopIndexVisible:Math.min(n-1,z.stopIndexVisible),stopIndexOverscan:Math.min(n-1,z.stopIndexOverscan)},S=u.useCallback(()=>D({cachedBounds:m,itemCount:n,itemSize:y}),[m,n,y]),E=u.useCallback(x=>{const C=L({containerElement:e,direction:r,isRtl:o,scrollOffset:x});return P({cachedBounds:m,containerScrollOffset:C,containerSize:v,itemCount:n,overscanCount:l})},[m,e,v,r,o,n,l]);H(()=>{const x=e?.scrollTop??0;O(E(x))},[e,r,E]),H(()=>{if(!e)return;const x=()=>{O(C=>{const{scrollLeft:T,scrollTop:p}=e,g=L({containerElement:e,direction:r,isRtl:o,scrollOffset:p}),I=P({cachedBounds:m,containerScrollOffset:g,containerSize:v,itemCount:n,overscanCount:l});return R(I,C)?C:I})};return e.addEventListener("scroll",x),()=>{e.removeEventListener("scroll",x)}},[m,e,v,r,n,l]);const j=U(({align:x="auto",containerScrollOffset:C,index:T})=>{let p=Y({align:x,cachedBounds:m,containerScrollOffset:C,containerSize:v,index:T,itemCount:n,itemSize:y});if(e){if(p=L({containerElement:e,direction:r,isRtl:o,scrollOffset:p}),typeof e.scrollTo!="function"){const g=E(p);R(z,g)||O(g)}return p}});return{getCellBounds:b,getEstimatedSize:S,scrollToIndex:j,startIndexOverscan:M,startIndexVisible:$,stopIndexOverscan:k,stopIndexVisible:V}}function Q(e){return u.useMemo(()=>e,Object.values(e))}function X(e,t){const{ariaAttributes:i,style:r,...o}=e,{ariaAttributes:n,style:d,...s}=t;return R(i,n)&&R(r,d)&&R(o,s)}function ee(e){return e!=null&&typeof e=="object"&&"getAverageRowHeight"in e&&typeof e.getAverageRowHeight=="function"}const te="data-react-window-index";function se({children:e,className:t,defaultHeight:i=0,listRef:r,onResize:o,onRowsRendered:n,overscanCount:d=3,rowComponent:s,rowCount:a,rowHeight:l,rowProps:f,tagName:h="div",style:w,...v}){const y=Q(f),m=u.useMemo(()=>u.memo(s,X),[s]),[b,z]=u.useState(null),O=ee(l),$=u.useMemo(()=>O?p=>l.getRowHeight(p)??l.getAverageRowHeight():l,[O,l]),{getCellBounds:M,getEstimatedSize:V,scrollToIndex:k,startIndexOverscan:S,startIndexVisible:E,stopIndexOverscan:j,stopIndexVisible:x}=K({containerElement:b,containerStyle:w,defaultContainerSize:i,direction:"vertical",itemCount:a,itemProps:y,itemSize:$,onResize:o,overscanCount:d});u.useImperativeHandle(r,()=>({get element(){return b},scrollToRow({align:p="auto",behavior:g="auto",index:I}){const B=k({align:p,containerScrollOffset:b?.scrollTop??0,index:I});typeof b?.scrollTo=="function"&&b.scrollTo({behavior:g,top:B})}}),[b,k]),H(()=>{if(!b)return;const p=Array.from(b.children).filter((g,I)=>{if(g.hasAttribute("aria-hidden"))return!1;const B=`${S+I}`;return g.setAttribute(te,B),!0});if(O)return l.observeRowElements(p)},[b,O,l,S,j]),u.useEffect(()=>{S>=0&&j>=0&&n&&n({startIndex:E,stopIndex:x},{startIndex:S,stopIndex:j})},[n,S,E,j,x]);const C=u.useMemo(()=>{const p=[];if(a>0)for(let g=S;g<=j;g++){const I=M(g);p.push(u.createElement(m,{...y,ariaAttributes:{"aria-posinset":g+1,"aria-setsize":a,role:"listitem"},key:g,index:g,style:{position:"absolute",left:0,transform:`translateY(${I.scrollOffset}px)`,height:O?void 0:I.size,width:"100%"}}))}return p},[m,M,O,a,y,S,j]),T=c.jsx("div",{"aria-hidden":!0,style:{height:V(),width:"100%",zIndex:-1}});return u.createElement(h,{role:"list",...v,className:t,ref:z,style:{position:"relative",maxHeight:"100%",flexGrow:1,overflowY:"auto",...w}},C,e,T)}const ie=()=>{const e=s=>s?s instanceof q?new Date(s.seconds*1e3).toLocaleString():s instanceof Date?s.toLocaleString():typeof s=="string"?s:typeof s=="object"&&s.seconds!==void 0?new Date(s.seconds*1e3).toLocaleString():String(s):"",[t,i]=u.useState([]),[r,o]=u.useState(!0);u.useEffect(()=>{let s=null;return(async()=>{o(!0);try{s=F(l=>{i(l),o(!1)})}catch(l){console.error("Error loading history:",l),o(!1)}})(),()=>{s&&s()}},[]);const n=u.memo(({index:s,style:a,data:l})=>{const{historyItems:f}=l,h=f[s];return c.jsxs("div",{style:a,className:"history-item-virtual",children:[c.jsxs("div",{className:"history-header-row",children:[c.jsxs("div",{className:"history-info",children:[c.jsxs("span",{className:"table-number",children:["Table ",h.tableId]}),c.jsx("span",{className:"timestamp",children:e(h.timestamp)}),c.jsxs("span",{className:"total-amount",children:["₹",h.total]})]}),c.jsx("div",{className:"history-actions",children:c.jsx("button",{className:"restore-btn",onClick:()=>alert(`Restore order for Table ${h.tableId}`),children:"Restore"})})]}),c.jsx("div",{className:"history-orders",children:h.orders.map((w,v)=>c.jsxs("div",{className:"history-order",children:[c.jsxs("h4",{children:["Order ",v+1]}),c.jsx("div",{className:"history-items",children:w.items.map((y,m)=>c.jsxs("div",{className:"history-item-row",children:[c.jsx("span",{className:"item-name",children:y.name}),c.jsxs("span",{className:"item-qty",children:["x",y.quantity]}),c.jsxs("span",{className:"item-price",children:["₹",(y.price*y.quantity).toFixed(2)]})]},`${h.id}-${v}-${m}`))}),c.jsxs("div",{className:"order-total",children:["Order Total: ₹",w.total.toFixed(2)]})]},`${h.id}-${v}`))})]})}),d=u.useMemo(()=>({historyItems:t}),[t]);return r?c.jsxs("div",{className:"history-page",children:[c.jsx(A,{currentPage:"history"}),c.jsx("div",{className:"page-content",children:c.jsx("div",{className:"loading",children:"Loading history..."})})]}):c.jsxs("div",{className:"history-page",children:[c.jsx(A,{currentPage:"history"}),c.jsxs("div",{className:"page-content",children:[c.jsxs("div",{className:"history-header",children:[c.jsx("h1",{children:"Order History"}),c.jsx("div",{className:"history-stats",children:c.jsxs("span",{children:["Total Entries: ",t.length]})})]}),t.length===0?c.jsx("div",{className:"no-history",children:c.jsx("p",{children:"No order history yet."})}):c.jsx("div",{className:"history-list-virtual",children:c.jsx(se,{height:600,itemCount:t.length,itemSize:200,itemData:d,overscanCount:5,children:n})})]})]})},ae=u.memo(ie);export{ae as default};
//# sourceMappingURL=HistoryPage-C9c5VsJ_.js.map
